<!DOCTYPE html>
<html>
  <head>
    <title>Kalibrasi Robot | Inayah</title>
    <link href="css/output.css" rel="stylesheet" />
    <link rel="stylesheet" href="vendor/sweetalert2/dist/sweetalert2.min.css" />
    <link rel="stylesheet" href="vendor/fontawesome/css/all.min.css" />
    <link rel="stylesheet" href="css/main.min.css" />
  </head>

  <body class="regional green">
    <!-- navbar -->
    <ul class="nav navbar-c justify-content-center my-3 nav-pills">
      <li class="nav-item">
        <a class="nav-link" aria-current="page" href="/">Dashboard</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="perintah.html">Perintah</a>
      </li>
      <li class="nav-item">
        <a class="nav-link active" href="kalibrasi.html">Kalibrasi</a>
      </li>
    </ul>

    <div class="container pt-8 pb-16">
      <div class="row">
        <!-- FAKTOR GERAK -->
        <div class="col-lg-7">
          <div
            class="bg-white rounded-2xl shadow-xs p-6 border-[1px] border-black"
          >
            <h2 class="text-xl font-bold mb-4 text-green-700">Faktor Gerak</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
              <div class="faktor-item">
                <label class="form-label">Faktor Maju</label>
                <div class="grid grid-cols-3 gap-2">
                  <div>
                    <div>
                      <label class="sub-label">Kiri</label>
                      <input
                        id="FAKTOR_MAJU_0"
                        type="number"
                        step="any"
                        class="input-number"
                        value="1"
                      />
                    </div>
                  </div>
                  <div>
                    <div>
                      <label class="sub-label">Kanan</label>
                      <input
                        id="FAKTOR_MAJU_1"
                        type="number"
                        step="any"
                        class="input-number"
                        value="1.0125"
                      />
                    </div>
                  </div>
                  <div>
                    <div>
                      <label class="sub-label">Belakang</label>
                      <input
                        id="FAKTOR_MAJU_2"
                        type="number"
                        step="any"
                        class="input-number"
                        value="0"
                      />
                    </div>
                  </div>
                </div>
              </div>

              <!-- Ulangi untuk semua faktor -->
              <div class="faktor-item">
                <label class="form-label">Faktor Maju Pelan</label>
                <div class="grid grid-cols-3 gap-2">
                  <div>
                    <label class="sub-label">Kiri</label>
                    <input
                      id="FAKTOR_MAJU_PELAN_0"
                      type="number"
                      step="any"
                      class="input-number"
                      value="1"
                    />
                  </div>
                  <div>
                    <label class="sub-label">Kanan</label>
                    <input
                      id="FAKTOR_MAJU_PELAN_1"
                      type="number"
                      step="any"
                      class="input-number"
                      value="1.0125"
                    />
                  </div>
                  <div>
                    <label class="sub-label">Belakang</label>
                    <input
                      id="FAKTOR_MAJU_PELAN_2"
                      type="number"
                      step="any"
                      class="input-number"
                      value="0"
                    />
                  </div>
                </div>
              </div>

              <!-- Sisanya copy pola di atas -->
              <div class="faktor-item">
                <label class="form-label">Faktor Mundur</label>
                <div class="grid grid-cols-3 gap-2">
                  <div>
                    <label class="sub-label">Kiri</label>
                    <input
                      id="FAKTOR_MUNDUR_0"
                      type="number"
                      step="any"
                      class="input-number"
                      value="1"
                    />
                  </div>
                  <div>
                    <label class="sub-label">Kanan</label>
                    <input
                      id="FAKTOR_MUNDUR_1"
                      type="number"
                      step="any"
                      class="input-number"
                      value="1.35"
                    />
                  </div>
                  <div>
                    <label class="sub-label">Belakang</label>
                    <input
                      id="FAKTOR_MUNDUR_2"
                      type="number"
                      step="any"
                      class="input-number"
                      value="0"
                    />
                  </div>
                </div>
              </div>

              <div class="faktor-item">
                <label class="form-label">Faktor Mundur Pelan</label>
                <div class="grid grid-cols-3 gap-2">
                  <div>
                    <label class="sub-label">Kiri</label>
                    <input
                      id="FAKTOR_MUNDUR_PELAN_0"
                      type="number"
                      step="any"
                      class="input-number"
                      value="1"
                    />
                  </div>
                  <div>
                    <label class="sub-label">Kanan</label>
                    <input
                      id="FAKTOR_MUNDUR_PELAN_1"
                      type="number"
                      step="any"
                      class="input-number"
                      value="1.35"
                    />
                  </div>
                  <div>
                    <label class="sub-label">Belakang</label>
                    <input
                      id="FAKTOR_MUNDUR_PELAN_2"
                      type="number"
                      step="any"
                      class="input-number"
                      value="0"
                    />
                  </div>
                </div>
              </div>

              <div class="faktor-item">
                <label class="form-label">Faktor Kanan</label>
                <div class="grid grid-cols-3 gap-2">
                  <div>
                    <label class="sub-label">Kiri</label>
                    <input
                      id="FAKTOR_KANAN_0"
                      type="number"
                      step="any"
                      class="input-number"
                      value="1"
                    />
                  </div>
                  <div>
                    <label class="sub-label">Kanan</label>
                    <input
                      id="FAKTOR_KANAN_1"
                      type="number"
                      step="any"
                      class="input-number"
                      value="1.075"
                    />
                  </div>
                  <div>
                    <label class="sub-label">Belakang</label>
                    <input
                      id="FAKTOR_KANAN_2"
                      type="number"
                      step="any"
                      class="input-number"
                      value="2"
                    />
                  </div>
                </div>
              </div>

              <div class="faktor-item">
                <label class="form-label">Faktor Kanan Pelan</label>
                <div class="grid grid-cols-3 gap-2">
                  <div>
                    <label class="sub-label">Kiri</label>
                    <input
                      id="FAKTOR_KANAN_PELAN_0"
                      type="number"
                      step="any"
                      class="input-number"
                      value="1"
                    />
                  </div>
                  <div>
                    <label class="sub-label">Kanan</label>
                    <input
                      id="FAKTOR_KANAN_PELAN_1"
                      type="number"
                      step="any"
                      class="input-number"
                      value="1.075"
                    />
                  </div>
                  <div>
                    <label class="sub-label">Belakang</label>
                    <input
                      id="FAKTOR_KANAN_PELAN_2"
                      type="number"
                      step="any"
                      class="input-number"
                      value="2"
                    />
                  </div>
                </div>
              </div>

              <div class="faktor-item">
                <label class="form-label">Faktor Kiri</label>
                <div class="grid grid-cols-3 gap-2">
                  <div>
                    <label class="sub-label">Kiri</label>
                    <input
                      id="FAKTOR_KIRI_0"
                      type="number"
                      step="any"
                      class="input-number"
                      value="1"
                    />
                  </div>
                  <div>
                    <label class="sub-label">Kanan</label>
                    <input
                      id="FAKTOR_KIRI_1"
                      type="number"
                      step="any"
                      class="input-number"
                      value="1.3"
                    />
                  </div>
                  <div>
                    <label class="sub-label">Belakang</label>
                    <input
                      id="FAKTOR_KIRI_2"
                      type="number"
                      step="any"
                      class="input-number"
                      value="2"
                    />
                  </div>
                </div>
              </div>

              <div class="faktor-item">
                <label class="form-label">Faktor Kiri Pelan</label>
                <div class="grid grid-cols-3 gap-2">
                  <div>
                    <label class="sub-label">Kiri</label>
                    <input
                      id="FAKTOR_KIRI_PELAN_0"
                      type="number"
                      step="any"
                      class="input-number"
                      value="1"
                    />
                  </div>
                  <div>
                    <label class="sub-label">Kanan</label>
                    <input
                      id="FAKTOR_KIRI_PELAN_1"
                      type="number"
                      step="any"
                      class="input-number"
                      value="1.3"
                    />
                  </div>
                  <div>
                    <label class="sub-label">Belakang</label>
                    <input
                      id="FAKTOR_KIRI_PELAN_2"
                      type="number"
                      step="any"
                      class="input-number"
                      value="2"
                    />
                  </div>
                </div>
              </div>
            </div>

            <div class="mt-4">
              <h3 class="text-xl font-bold mb-4 text-purple-700">
                Faktor Odometry
              </h3>
              <div class="grid grid-cols-3 gap-4">
                <div>
                  <label class="form-label">Theta</label
                  ><input
                    id="FAKTOR_ODOMETRY_0"
                    type="number"
                    class="input-number"
                    value="0"
                  />
                </div>
                <div>
                  <label class="form-label">X</label
                  ><input
                    id="FAKTOR_ODOMETRY_1"
                    type="number"
                    class="input-number"
                    value="0"
                  />
                </div>
                <div>
                  <label class="form-label">Y</label
                  ><input
                    id="FAKTOR_ODOMETRY_2"
                    type="number"
                    class="input-number"
                    value="0"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- KECEPATAN -->
        <div class="col-lg-5">
          <div
            class="bg-white rounded-2xl shadow-xs p-6 border-[1px] border-black"
          >
            <h2 class="text-xl font-bold mb-4 text-blue-700">Kecepatan</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
              <div>
                <label class="form-label">Pelan</label
                ><input
                  id="PELAN_SPEED"
                  type="number"
                  class="input-number"
                  value="20"
                />
              </div>
              <div>
                <label class="form-label">Normal</label
                ><input
                  id="NORMAL_SPEED"
                  type="number"
                  class="input-number"
                  value="50"
                />
              </div>
              <div>
                <label class="form-label">Putar</label
                ><input
                  id="PUTAR_SPEED"
                  type="number"
                  class="input-number"
                  value="20"
                />
              </div>
              <div>
                <label class="form-label">Putar Pelan</label
                ><input
                  id="PUTAR_PELAN_SPEED"
                  type="number"
                  class="input-number"
                  value="10"
                />
              </div>
              <div>
                <label class="form-label">Step Speed</label
                ><input
                  id="STEP_SPEED"
                  type="number"
                  class="input-number"
                  value="75"
                />
              </div>
            </div>
            <div class="mt-4">
              <h3 class="text-md font-semibold text-gray-600 mb-4">Servo</h3>
              <div class="flex gap-4">
                <div>
                  <div>
                    <label class="form-label">Rotate Delay</label>
                    <input
                      id="ROTATE_DELAY"
                      type="number"
                      class="input-number"
                      value="20"
                    />
                  </div>
                </div>
                <div>
                  <div>
                    <label class="form-label">Rotate Size</label>
                    <input
                      id="ROTATE_SIZE"
                      type="number"
                      class="input-number"
                      value="1"
                    />
                  </div>
                </div>
              </div>
            </div>

            <div class="mt-4">
              <h3 class="text-xl font-bold mb-4 text-purple-700">Toleransi</h3>
              <div class="grid grid-cols-3 gap-4">
                <div>
                  <label class="form-label">Toleransi X</label
                  ><input
                    id="TOLERANCE_X"
                    type="number"
                    class="input-number"
                    value="0"
                  />
                </div>
                <div>
                  <label class="form-label">Toleransi Y</label
                  ><input
                    id="TOLERANCE_Y"
                    type="number"
                    class="input-number"
                    value="0"
                  />
                </div>
                <div>
                  <label class="form-label">Toleransi Theta</label
                  ><input
                    id="TOLERANCE_THETA"
                    type="number"
                    class="input-number"
                    value="0"
                  />
                </div>
              </div>
            </div>

            <div class="mt-4">
              <h3 class="text-xl font-bold mb-4 text-purple-700">
                Batas Jarak
              </h3>
              <div class="grid grid-cols-3 gap-4">
                <div>
                  <label class="form-label">Depan</label
                  ><input
                    id="FRONT_COLLISION_THRESHOLD"
                    type="number"
                    class="input-number"
                    value="0"
                  />
                </div>
                <div>
                  <label class="form-label">Samping</label
                  ><input
                    id="SIDE_COLLISION_THRESHOLD"
                    type="number"
                    class="input-number"
                    value="0"
                  />
                </div>
                <div>
                  <label class="form-label">Koreksi Samping</label
                  ><input
                    id="SIDE_CORRECTION_THRESHOLD"
                    type="number"
                    class="input-number"
                    value="0"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="vendor/sweetalert2/dist/sweetalert2.min.js"></script>
    <script>
      var socket = io();

      socket.emit("get-kalibrasi");

      socket.on("post-kalibrasi", (data) => {
        document.querySelectorAll("input").forEach((d) => {
          const id = d.id;
          const key = id.startsWith("FAKTOR")
            ? id.split("_").slice(0, -1).join("_")
            : id;

          if (id.startsWith("FAKTOR")) {
            const index = parseInt(id.split("_").pop());
            d.value = data[key][index];
          } else {
            d.value = data[key];
          }
        });
      });

      document.querySelectorAll("input").forEach((d) => {
        d.addEventListener("keydown", (ev) => {
          if (ev.keyCode != 13) return;

          const data = {};
          document.querySelectorAll("input").forEach((d, i) => {
            const id = d.id;
            const key = id.startsWith("FAKTOR")
              ? id.split("_").slice(0, -1).join("_")
              : id;

            if (id.startsWith("FAKTOR")) {
              const index = parseInt(id.split("_").pop());
              if (!data[key]) data[key] = [];
              data[key][index] = parseFloat(d.value);
            } else {
              data[key] = parseInt(d.value);
            }
          });

          socket.emit("save-kalibrasi", { data });
        });
      });

      socket.on("kalibrasi-saved", () => {
        Swal.fire({
          title: `Tunggu`,
          text: `Mengirim kalibrasi ke Raspi..`,
          icon: "info",
          timer: 19 * 2000,
          showConfirmButton: false,
          didOpen: () => {
            Swal.showLoading();
          },
        });
      });

      socket.on("kalibrasi-sent", () => {
        Swal.fire({
          title: `Tunggu`,
          text: `Terkirim ke Raspi! Mengirim kalibrasi ke Arduino..`,
          icon: "info",
          timer: 19 * 2000,
          showConfirmButton: false,
          didOpen: () => {
            Swal.showLoading();
          },
        });
      });

      socket.on("calibrated-client", () => {
        Swal.fire({
          title: `Terkirim!`,
          text: `Kalibrasi berhasil dikirim ke Arduino!`,
          icon: "success",
          timer: 1000,
        });
      });
    </script>
  </body>
</html>
